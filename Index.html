<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión Estratégica Lechera</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-active {
            border-bottom: 2px solid #10b981;
            color: #059669;
            background-color: #ecfdf5;
        }
        .tab-inactive {
            border-bottom: 2px solid transparent;
            color: #6b7280;
        }
        .tab-inactive:hover {
            color: #374151;
            background-color: #f9fafb;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .scroll-container {
            max-height: 24rem;
            overflow-y: auto;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div class="bg-green-600 text-white p-6 shadow-lg">
        <h1 class="text-3xl font-bold">Sistema de Gestión Estratégica Lechera</h1>
        <p class="text-green-100 mt-2">San Pedro de los Milagros, Antioquia - Colombia</p>
    </div>

    <div class="container mx-auto px-4 py-6">
        <!-- Navegación por pestañas -->
        <div class="bg-white rounded-lg shadow-sm mb-6 overflow-x-auto">
            <div class="flex border-b" id="tab-navigation">
                <!-- Las pestañas se generarán dinámicamente -->
            </div>
        </div>

        <!-- Contenido de las pestañas -->
        <div id="tab-content">
            <!-- El contenido se generará dinámicamente -->
        </div>
    </div>

    <script>
        // Datos de la aplicación
        let appData = {
            // Datos Generales
            vacas: 114,
            area: 125,
            volumen: 902300,
            precio_leche: 2400,
            empleados: 7,
            sistema_produccion: 'Pastoreo',
            novillas: 101,
            region: 'San Pedro de los Milagros',
            valor_hectarea: 45000000,
            ensilaje: 42,
            
            // Ingresos
            venta_leche: 2165520000,
            venta_animales: 156000000,
            venta_estiercol: 12000000,
            otros_ingresos: 0,
            cambio_stock_animales: 85000000,
            cambio_stock_alimentos: 25000000,
            
            // Gastos Básicos
            mantenimiento_maquinas: 45000000,
            mantenimiento_instalaciones: 65000000,
            alquiler_maquinas: 55000000,
            energia: 72000000,
            alimentos_comprados: 865000000,
            correctivos_fertilizantes: 35000000,
            productos_quimicos: 25000000,
            semillas: 15000000,
            reproduccion: 35000000,
            salud: 55000000,
            consumibles: 45000000,
            bst: 48000000,
            impuestos: 42000000,
            
            // Gastos Adicionales
            mano_obra_fija: 168000000,
            mano_obra_temporal: 35000000,
            administracion: 96000000,
            intereses_prestamos: 45000000,
            depreciacion_maquinaria: 35000000,
            depreciacion_instalaciones: 25000000,
            
            // Inversiones
            inversiones_instalaciones: 850000000,
            inversiones_maquinaria: 650000000,
            inversiones_animales: 1250000000,
            inversiones_tierra: 5625000000
        };

        let activeTab = 'datos_generales';
        let aiAnalysis = null;
        let isAnalyzing = false;

        // Iconos usando Lucide
        const icons = {
            Calculator: 'calculator',
            TrendingUp: 'trending-up',
            DollarSign: 'dollar-sign',
            PieChart: 'pie-chart',
            BarChart3: 'bar-chart-3',
            Brain: 'brain',
            AlertCircle: 'alert-circle',
            CheckCircle: 'check-circle',
            Info: 'info'
        };

        // Funciones de formateo
        function formatCurrency(value) {
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0
            }).format(value);
        }

        function formatNumber(value) {
            return new Intl.NumberFormat('es-CO').format(value);
        }

        // Cálculos principales
        function getCalculations() {
            const leche_eq_kg = appData.volumen * 1.18;
            const total_ingresos = appData.venta_leche + appData.venta_animales + appData.venta_estiercol + 
                                 appData.otros_ingresos + appData.cambio_stock_animales + appData.cambio_stock_alimentos;
            
            const gastos_basicos = appData.mantenimiento_maquinas + appData.mantenimiento_instalaciones + 
                                 appData.alquiler_maquinas + appData.energia + appData.alimentos_comprados + 
                                 appData.correctivos_fertilizantes + appData.productos_quimicos + appData.semillas + 
                                 appData.reproduccion + appData.salud + appData.consumibles + appData.bst + appData.impuestos;
            
            const gastos_adicionales = appData.mano_obra_fija + appData.mano_obra_temporal + appData.administracion + 
                                     appData.intereses_prestamos + appData.depreciacion_maquinaria + 
                                     appData.depreciacion_instalaciones;
            
            const total_inversiones = appData.inversiones_instalaciones + appData.inversiones_maquinaria + 
                                    appData.inversiones_animales + appData.inversiones_tierra;
            
            const lucro = total_ingresos - (gastos_basicos + gastos_adicionales);
            const retorno_capital = (lucro / total_inversiones) * 100;
            const litros_por_empleado = appData.volumen / appData.empleados;
            const costo_produccion_litro = (gastos_basicos + gastos_adicionales) / appData.volumen;

            return {
                leche_eq_kg,
                total_ingresos,
                gastos_basicos,
                gastos_adicionales,
                total_inversiones,
                lucro,
                retorno_capital,
                litros_por_empleado,
                costo_produccion_litro
            };
        }

        // Función para crear iconos
        function createIcon(iconName, size = 16, className = '') {
            return `<i data-lucide="${iconName}" class="w-${size/4} h-${size/4} ${className}"></i>`;
        }

        // Componente InputField
        function createInputField(label, value, onChange, type = 'number', min = 0, tooltip = '') {
            const tooltipHtml = tooltip ? `<span class="ml-1 text-gray-400" title="${tooltip}">${createIcon('info', 14, 'inline')}</span>` : '';
            
            return `
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        ${label}
                        ${tooltipHtml}
                    </label>
                    <input
                        type="${type}"
                        value="${value}"
                        ${type === 'number' ? `min="${min}"` : ''}
                        onchange="${onChange}"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                </div>
            `;
        }

        // Componente SimpleChart
        function createSimpleChart(title, data) {
            const maxValue = Math.max(...data.map(d => d.value));
            const chartItems = data.map((item, index) => {
                const percentage = (item.value / maxValue) * 100;
                const formattedValue = typeof item.value === 'number' ? formatNumber(item.value) : item.value;
                
                return `
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">${item.label}</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-32 bg-gray-200 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full progress-bar" style="width: ${percentage}%"></div>
                            </div>
                            <span class="text-sm font-medium w-24 text-right">${formattedValue}</span>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="bg-white p-4 rounded-lg shadow-md mb-4">
                    <h4 class="text-lg font-semibold mb-3 text-gray-800">${title}</h4>
                    <div class="space-y-2">
                        ${chartItems}
                    </div>
                </div>
            `;
        }

        // Componente KPICard
        function createKPICard(title, value, iconName, color = 'green', change = null, unit = '') {
            const changeHtml = change ? `
                <p class="text-sm ${change > 0 ? 'text-green-600' : 'text-red-600'}">
                    ${change > 0 ? '+' : ''}${change}% vs anterior
                </p>
            ` : '';

            const formattedValue = typeof value === 'number' ? formatNumber(value) : value;

            return `
                <div class="bg-white p-4 rounded-lg shadow-md">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">${title}</p>
                            <p class="text-2xl font-bold text-${color}-600">
                                ${formattedValue} ${unit}
                            </p>
                            ${changeHtml}
                        </div>
                        ${createIcon(iconName, 32, `text-${color}-600`)}
                    </div>
                </div>
            `;
        }

        // Función para análisis con IA
        async function analyzeWithAI() {
            if (!window.claude || !window.claude.complete) {
                alert('Función de análisis IA no disponible');
                return;
            }

            isAnalyzing = true;
            updateAnalysisButton();
            
            const calculations = getCalculations();
            
            const prompt = `
            Analiza estos datos de una finca lechera en San Pedro de los Milagros, Antioquia:
            
            DATOS PRODUCTIVOS:
            - Vacas en producción: ${appData.vacas}
            - Área: ${appData.area} hectáreas
            - Producción anual: ${formatNumber(appData.volumen)} litros
            - Precio leche: ${formatCurrency(appData.precio_leche)}/litro
            - Empleados: ${appData.empleados}
            
            RESULTADOS FINANCIEROS:
            - Ingresos totales: ${formatCurrency(calculations.total_ingresos)}
            - Gastos básicos: ${formatCurrency(calculations.gastos_basicos)}
            - Gastos adicionales: ${formatCurrency(calculations.gastos_adicionales)}
            - Lucro: ${formatCurrency(calculations.lucro)}
            - Retorno sobre capital: ${calculations.retorno_capital.toFixed(2)}%
            - Costo producción/litro: ${formatCurrency(calculations.costo_produccion_litro)}
            
            PRODUCTIVIDAD:
            - Litros/vaca/año: ${formatNumber(appData.volumen / appData.vacas)}
            - Litros/empleado: ${formatNumber(calculations.litros_por_empleado)}
            - Litros/hectárea: ${formatNumber(appData.volumen / appData.area)}
            
            Proporciona un análisis detallado en formato JSON con:
            {
              "resumen_ejecutivo": "Análisis general de la situación",
              "fortalezas": ["lista de fortalezas"],
              "areas_mejora": ["lista de áreas de mejora"],
              "recomendaciones": ["lista de recomendaciones específicas"],
              "indicadores_clave": {
                "productividad": "análisis de productividad",
                "rentabilidad": "análisis de rentabilidad",
                "eficiencia": "análisis de eficiencia"
              },
              "alertas": ["alertas importantes si las hay"]
            }
            
            Responde SOLO con el JSON válido, sin texto adicional.
            `;

            try {
                const response = await window.claude.complete(prompt);
                aiAnalysis = JSON.parse(response);
            } catch (error) {
                console.error('Error en análisis IA:', error);
                aiAnalysis = {
                    resumen_ejecutivo: "Error al generar análisis. Por favor, intenta nuevamente.",
                    fortalezas: [],
                    areas_mejora: [],
                    recomendaciones: [],
                    indicadores_clave: {},
                    alertas: []
                };
            }
            
            isAnalyzing = false;
            updateAnalysisButton();
            renderTabContent();
        }

        // Función para actualizar el botón de análisis
        function updateAnalysisButton() {
            const button = document.getElementById('analyze-button');
            if (button) {
                button.disabled = isAnalyzing;
                button.textContent = isAnalyzing ? 'Analizando...' : 'Analizar con IA';
                button.className = `px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors ${isAnalyzing ? 'opacity-50 cursor-not-allowed' : ''}`;
            }
        }

        // Componente para análisis IA
        function createAIAnalysisPanel() {
            let analysisContent = '';
            
            if (aiAnalysis) {
                analysisContent = `
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-2">Resumen Ejecutivo</h4>
                            <p class="text-gray-700">${aiAnalysis.resumen_ejecutivo}</p>
                        </div>
                        
                        ${aiAnalysis.fortalezas && aiAnalysis.fortalezas.length > 0 ? `
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-green-800 mb-2 flex items-center">
                                    ${createIcon('check-circle', 16, 'mr-2')}
                                    Fortalezas
                                </h4>
                                <ul class="list-disc list-inside text-green-700 space-y-1">
                                    ${aiAnalysis.fortalezas.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        ${aiAnalysis.areas_mejora && aiAnalysis.areas_mejora.length > 0 ? `
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-yellow-800 mb-2 flex items-center">
                                    ${createIcon('alert-circle', 16, 'mr-2')}
                                    Áreas de Mejora
                                </h4>
                                <ul class="list-disc list-inside text-yellow-700 space-y-1">
                                    ${aiAnalysis.areas_mejora.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        ${aiAnalysis.recomendaciones && aiAnalysis.recomendaciones.length > 0 ? `
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-blue-800 mb-2">Recomendaciones</h4>
                                <ul class="list-disc list-inside text-blue-700 space-y-1">
                                    ${aiAnalysis.recomendaciones.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            return `
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800 flex items-center">
                            ${createIcon('brain', 24, 'mr-2 text-indigo-600')}
                            Análisis Inteligente
                        </h3>
                        <button
                            id="analyze-button"
                            onclick="analyzeWithAI()"
                            class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors"
                        >
                            Analizar con IA
                        </button>
                    </div>
                    ${analysisContent}
                </div>
            `;
        }

        // Definición de pestañas
        const tabs = [
            { id: 'datos_generales', label: 'Datos Generales', icon: 'calculator' },
            { id: 'ingresos', label: 'Ingresos', icon: 'trending-up' },
            { id: 'gastos', label: 'Gastos', icon: 'dollar-sign' },
            { id: 'inversiones', label: 'Inversiones', icon: 'pie-chart' },
            { id: 'resultados', label: 'Resultados', icon: 'bar-chart-3' },
            { id: 'analisis', label: 'Análisis IA', icon: 'brain' }
        ];

        // Función para cambiar de pestaña
        function setActiveTab(tabId) {
            activeTab = tabId;
            renderTabs();
            renderTabContent();
        }

        // Función para actualizar datos
        function updateData(field, value) {
            appData[field] = value;
            renderTabContent();
        }

        // Renderizar pestañas
        function renderTabs() {
            const tabNavigation = document.getElementById('tab-navigation');
            tabNavigation.innerHTML = tabs.map(tab => `
                <button
                    onclick="setActiveTab('${tab.id}')"
                    class="flex items-center px-6 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap ${
                        activeTab === tab.id ? 'tab-active' : 'tab-inactive'
                    }"
                >
                    ${createIcon(tab.icon, 16, 'mr-2')}
                    ${tab.label}
                </button>
            `).join('');
        }

        // Renderizar contenido de pestañas
        function renderTabContent() {
            const calculations = getCalculations();
            const tabContent = document.getElementById('tab-content');
            
            let content = '';

            if (activeTab === 'datos_generales') {
                content = `
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
                            ${createKPICard('Vacas en Producción', appData.vacas, 'calculator', 'green', null, 'cabezas')}
                            ${createKPICard('Área Total', appData.area, 'pie-chart', 'blue', null, 'hectáreas')}
                            ${createKPICard('Producción Anual', appData.volumen, 'trending-up', 'purple', null, 'litros')}
                            ${createKPICard('Precio Leche', formatCurrency(appData.precio_leche), 'dollar-sign', 'yellow', null, '/litro')}
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Datos Productivos</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    ${createInputField('Vacas en Producción', appData.vacas, 'updateData("vacas", this.value)', 'number', 0, 'Número de vacas actualmente en producción')}
                                    ${createInputField('Área de la Finca (ha)', appData.area, 'updateData("area", this.value)', 'number', 0, 'Área total de la finca en hectáreas')}
                                    ${createInputField('Volumen Anual (L)', appData.volumen, 'updateData("volumen", this.value)', 'number', 0, 'Producción total de leche en el año')}
                                    ${createInputField('Precio Leche ($/L)', appData.precio_leche, 'updateData("precio_leche", this.value)', 'number', 0, 'Precio promedio pagado por litro de leche')}
                                    ${createInputField('Número de Empleados', appData.empleados, 'updateData("empleados", this.value)', 'number', 0, 'Total de empleados en la finca')}
                                    ${createInputField('Número de Novillas', appData.novillas, 'updateData("novillas", this.value)', 'number', 0, 'Número de novillas en la finca')}
                                </div>
                            </div>

                            <div class="space-y-4">
                                ${createSimpleChart('Indicadores de Productividad', [
                                    { label: 'Litros/Vaca/Año', value: Math.round(appData.volumen / appData.vacas) },
                                    { label: 'Litros/Hectárea', value: Math.round(appData.volumen / appData.area) },
                                    { label: 'Litros/Empleado', value: Math.round(calculations.litros_por_empleado) },
                                    { label: 'Vacas/Hectárea', value: (appData.vacas / appData.area).toFixed(1) }
                                ])}
                                
                                <div class="bg-white p-4 rounded-lg shadow-md">
                                    <h4 class="text-lg font-semibold mb-3 text-gray-800">Información Adicional</h4>
                                    <div class="space-y-2">
                                        ${createInputField('Región', appData.region, 'updateData("region", this.value)', 'text')}
                                        ${createInputField('Sistema de Producción', appData.sistema_produccion, 'updateData("sistema_produccion", this.value)', 'text')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'ingresos') {
                content = `
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 mb-6">
                            ${createKPICard('Ingresos Totales', formatCurrency(calculations.total_ingresos), 'trending-up', 'green')}
                            ${createKPICard('Venta de Leche', formatCurrency(appData.venta_leche), 'dollar-sign', 'blue')}
                            ${createKPICard('Otros Ingresos', formatCurrency(calculations.total_ingresos - appData.venta_leche), 'pie-chart', 'purple')}
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Ingresos Operativos</h3>
                                <div class="space-y-4">
                                    ${createInputField('Venta de Leche ($/año)', appData.venta_leche, 'updateData("venta_leche", this.value)', 'number', 0, 'Ingresos por venta de leche en el año')}
                                    ${createInputField('Venta de Animales ($/año)', appData.venta_animales, 'updateData("venta_animales", this.value)', 'number', 0, 'Ingresos por venta de animales')}
                                    ${createInputField('Venta de Estiércol ($/año)', appData.venta_estiercol, 'updateData("venta_estiercol", this.value)', 'number', 0, 'Ingresos por venta de estiércol')}
                                    ${createInputField('Otros Ingresos ($/año)', appData.otros_ingresos, 'updateData("otros_ingresos", this.value)', 'number', 0, 'Otros ingresos diversos')}
                                    ${createInputField('Cambio Stock Animales ($/año)', appData.cambio_stock_animales, 'updateData("cambio_stock_animales", this.value)', 'number', 0, 'Cambio en el valor del stock de animales')}
                                    ${createInputField('Cambio Stock Alimentos ($/año)', appData.cambio_stock_alimentos, 'updateData("cambio_stock_alimentos", this.value)', 'number', 0, 'Cambio en el valor del stock de alimentos')}
                                </div>
                            </div>

                            <div class="space-y-4">
                                ${createSimpleChart('Composición de Ingresos', [
                                    { label: 'Venta de Leche', value: appData.venta_leche },
                                    { label: 'Venta de Animales', value: appData.venta_animales },
                                    { label: 'Venta de Estiércol', value: appData.venta_estiercol },
                                    { label: 'Cambio Stock Animales', value: appData.cambio_stock_animales },
                                    { label: 'Cambio Stock Alimentos', value: appData.cambio_stock_alimentos },
                                    { label: 'Otros Ingresos', value: appData.otros_ingresos }
                                ])}
                                
                                <div class="bg-white p-4 rounded-lg shadow-md">
                                    <h4 class="text-lg font-semibold mb-3 text-gray-800">Análisis de Ingresos</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Participación Leche:</span>
                                            <span class="font-medium">${((appData.venta_leche / calculations.total_ingresos) * 100).toFixed(1)}%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Ingreso por Vaca:</span>
                                            <span class="font-medium">${formatCurrency(calculations.total_ingresos / appData.vacas)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Ingreso por Hectárea:</span>
                                            <span class="font-medium">${formatCurrency(calculations.total_ingresos / appData.area)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'gastos') {
                content = `
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 mb-6">
                            ${createKPICard('Gastos Básicos', formatCurrency(calculations.gastos_basicos), 'dollar-sign', 'red')}
                            ${createKPICard('Gastos Adicionales', formatCurrency(calculations.gastos_adicionales), 'trending-up', 'orange')}
                            ${createKPICard('Gastos Totales', formatCurrency(calculations.gastos_basicos + calculations.gastos_adicionales), 'calculator', 'purple')}
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Gastos Básicos</h3>
                                <div class="space-y-4 scroll-container">
                                    ${createInputField('Mantenimiento Maquinaria', appData.mantenimiento_maquinas, 'updateData("mantenimiento_maquinas", this.value)')}
                                    ${createInputField('Mantenimiento Instalaciones', appData.mantenimiento_instalaciones, 'updateData("mantenimiento_instalaciones", this.value)')}
                                    ${createInputField('Alquiler de Máquinas', appData.alquiler_maquinas, 'updateData("alquiler_maquinas", this.value)')}
                                    ${createInputField('Energía y Combustibles', appData.energia, 'updateData("energia", this.value)')}
                                    ${createInputField('Alimentos Comprados', appData.alimentos_comprados, 'updateData("alimentos_comprados", this.value)')}
                                    ${createInputField('Fertilizantes', appData.correctivos_fertilizantes, 'updateData("correctivos_fertilizantes", this.value)')}
                                    ${createInputField('Productos Químicos', appData.productos_quimicos, 'updateData("productos_quimicos", this.value)')}
                                    ${createInputField('Semillas', appData.semillas, 'updateData("semillas", this.value)')}
                                    ${createInputField('Reproducción', appData.reproduccion, 'updateData("reproduccion", this.value)')}
                                    ${createInputField('Sanidad', appData.salud, 'updateData("salud", this.value)')}
                                    ${createInputField('Consumibles', appData.consumibles, 'updateData("consumibles", this.value)')}
                                    ${createInputField('BST', appData.bst, 'updateData("bst", this.value)')}
                                    ${createInputField('Impuestos', appData.impuestos, 'updateData("impuestos", this.value)')}
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div class="bg-white p-6 rounded-lg shadow-md">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">Gastos Adicionales</h3>
                                    <div class="space-y-4">
                                        ${createInputField('Mano de Obra Fija', appData.mano_obra_fija, 'updateData("mano_obra_fija", this.value)')}
                                        ${createInputField('Mano de Obra Temporal', appData.mano_obra_temporal, 'updateData("mano_obra_temporal", this.value)')}
                                        ${createInputField('Administración', appData.administracion, 'updateData("administracion", this.value)')}
                                        ${createInputField('Intereses Préstamos', appData.intereses_prestamos, 'updateData("intereses_prestamos", this.value)')}
                                        ${createInputField('Depreciación Maquinaria', appData.depreciacion_maquinaria, 'updateData("depreciacion_maquinaria", this.value)')}
                                        ${createInputField('Depreciación Instalaciones', appData.depreciacion_instalaciones, 'updateData("depreciacion_instalaciones", this.value)')}
                                    </div>
                                </div>

                                ${createSimpleChart('Principales Componentes de Gastos', [
                                    { label: 'Alimentos', value: appData.alimentos_comprados },
                                    { label: 'Mano de Obra Total', value: appData.mano_obra_fija + appData.mano_obra_temporal },
                                    { label: 'Administración', value: appData.administracion },
                                    { label: 'Energía', value: appData.energia },
                                    { label: 'Mantenimiento', value: appData.mantenimiento_maquinas + appData.mantenimiento_instalaciones },
                                    { label: 'Sanidad', value: appData.salud }
                                ])}
                                
                                <div class="bg-white p-4 rounded-lg shadow-md">
                                    <h4 class="text-lg font-semibold mb-3 text-gray-800">Análisis de Costos</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Costo por Litro:</span>
                                            <span class="font-medium">${formatCurrency(calculations.costo_produccion_litro)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Participación Alimentos:</span>
                                            <span class="font-medium">${((appData.alimentos_comprados / calculations.gastos_basicos) * 100).toFixed(1)}%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Costo por Vaca:</span>
                                            <span class="font-medium">${formatCurrency((calculations.gastos_basicos + calculations.gastos_adicionales) / appData.vacas)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'inversiones') {
                content = `
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
                            ${createKPICard('Inversión Total', formatCurrency(calculations.total_inversiones), 'pie-chart', 'blue')}
                            ${createKPICard('Tierra', formatCurrency(appData.inversiones_tierra), 'trending-up', 'green')}
                            ${createKPICard('Animales', formatCurrency(appData.inversiones_animales), 'calculator', 'purple')}
                            ${createKPICard('Infraestructura', formatCurrency(appData.inversiones_instalaciones + appData.inversiones_maquinaria), 'dollar-sign', 'orange')}
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Inversiones por Categoría</h3>
                                <div class="space-y-4">
                                    ${createInputField('Instalaciones ($)', appData.inversiones_instalaciones, 'updateData("inversiones_instalaciones", this.value)', 'number', 0, 'Valor de instalaciones y construcciones')}
                                    ${createInputField('Maquinaria y Equipo ($)', appData.inversiones_maquinaria, 'updateData("inversiones_maquinaria", this.value)', 'number', 0, 'Valor de maquinaria y equipos')}
                                    ${createInputField('Animales ($)', appData.inversiones_animales, 'updateData("inversiones_animales", this.value)', 'number', 0, 'Valor del hato ganadero')}
                                    ${createInputField('Tierra ($)', appData.inversiones_tierra, 'updateData("inversiones_tierra", this.value)', 'number', 0, 'Valor de la tierra')}
                                </div>
                            </div>

                            <div class="space-y-4">
                                ${createSimpleChart('Distribución de Inversiones', [
                                    { label: 'Tierra', value: appData.inversiones_tierra },
                                    { label: 'Animales', value: appData.inversiones_animales },
                                    { label: 'Instalaciones', value: appData.inversiones_instalaciones },
                                    { label: 'Maquinaria', value: appData.inversiones_maquinaria }
                                ])}
                                
                                <div class="bg-white p-4 rounded-lg shadow-md">
                                    <h4 class="text-lg font-semibold mb-3 text-gray-800">Indicadores de Inversión</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Inversión por Vaca:</span>
                                            <span class="font-medium">${formatCurrency(calculations.total_inversiones / appData.vacas)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Inversión por Hectárea:</span>
                                            <span class="font-medium">${formatCurrency(calculations.total_inversiones / appData.area)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>% Tierra:</span>
                                            <span class="font-medium">${((appData.inversiones_tierra / calculations.total_inversiones) * 100).toFixed(1)}%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>% Animales:</span>
                                            <span class="font-medium">${((appData.inversiones_animales / calculations.total_inversiones) * 100).toFixed(1)}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'resultados') {
                content = `
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
                            ${createKPICard('Lucro Anual', formatCurrency(calculations.lucro), 'trending-up', calculations.lucro > 0 ? 'green' : 'red')}
                            ${createKPICard('Retorno Capital', `${calculations.retorno_capital.toFixed(2)}%`, 'pie-chart', calculations.retorno_capital > 0 ? 'green' : 'red')}
                            ${createKPICard('Margen por Litro', formatCurrency(calculations.lucro / appData.volumen), 'calculator', (calculations.lucro / appData.volumen) > 0 ? 'green' : 'red')}
                            ${createKPICard('Productividad', `${(appData.volumen / appData.vacas).toFixed(0)} L/vaca`, 'bar-chart-3', 'blue')}
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Resultados Financieros</h3>
                                <div class="space-y-4">
                                    <div class="border-b pb-2">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Ingresos Totales:</span>
                                            <span class="text-green-600 font-bold">${formatCurrency(calculations.total_ingresos)}</span>
                                        </div>
                                    </div>
                                    <div class="border-b pb-2">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Gastos Básicos:</span>
                                            <span class="text-red-600">${formatCurrency(calculations.gastos_basicos)}</span>
                                        </div>
                                    </div>
                                    <div class="border-b pb-2">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Gastos Adicionales:</span>
                                            <span class="text-red-600">${formatCurrency(calculations.gastos_adicionales)}</span>
                                        </div>
                                    </div>
                                    <div class="border-b pb-2">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Gastos Totales:</span>
                                            <span class="text-red-600 font-bold">${formatCurrency(calculations.gastos_basicos + calculations.gastos_adicionales)}</span>
                                        </div>
                                    </div>
                                    <div class="pt-2">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-lg">Lucro:</span>
                                            <span class="font-bold text-lg ${calculations.lucro > 0 ? 'text-green-600' : 'text-red-600'}">
                                                ${formatCurrency(calculations.lucro)}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-4">
                                ${createSimpleChart('Análisis de Rentabilidad', [
                                    { label: 'Ingresos', value: calculations.total_ingresos },
                                    { label: 'Gastos Básicos', value: calculations.gastos_basicos },
                                    { label: 'Gastos Adicionales', value: calculations.gastos_adicionales },
                                    { label: 'Lucro', value: Math.abs(calculations.lucro) }
                                ])}
                                
                                <div class="bg-white p-4 rounded-lg shadow-md">
                                    <h4 class="text-lg font-semibold mb-3 text-gray-800">Indicadores Clave</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Margen Bruto:</span>
                                            <span class="font-medium">${((calculations.lucro / calculations.total_ingresos) * 100).toFixed(2)}%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Punto de Equilibrio:</span>
                                            <span class="font-medium">${formatCurrency((calculations.gastos_basicos + calculations.gastos_adicionales) / appData.volumen)}/L</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Eficiencia Productiva:</span>
                                            <span class="font-medium">${(appData.volumen / appData.area).toFixed(0)} L/ha</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Litros por Empleado:</span>
                                            <span class="font-medium">${formatNumber(calculations.litros_por_empleado)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'analisis') {
                content = `
                    <div class="space-y-6">
                        ${createAIAnalysisPanel()}
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Benchmarking Regional</h3>
                                <div class="space-y-4">
                                    <div class="border-l-4 border-blue-500 pl-4">
                                        <h4 class="font-semibold text-gray-800">Productividad vs Región</h4>
                                        <p class="text-sm text-gray-600">
                                            Su finca: ${(appData.volumen / appData.vacas).toFixed(0)} L/vaca/año
                                        </p>
                                        <p class="text-sm text-gray-600">
                                            Promedio regional: 6,500 L/vaca/año
                                        </p>
                                        <div class="text-sm font-medium ${(appData.volumen / appData.vacas) > 6500 ? 'text-green-600' : 'text-orange-600'}">
                                            ${(appData.volumen / appData.vacas) > 6500 ? '✓ Por encima del promedio' : '⚠ Por debajo del promedio'}
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-green-500 pl-4">
                                        <h4 class="font-semibold text-gray-800">Rentabilidad vs Sector</h4>
                                        <p class="text-sm text-gray-600">
                                            Su ROI: ${calculations.retorno_capital.toFixed(2)}%
                                        </p>
                                        <p class="text-sm text-gray-600">
                                            Promedio sector: 8-12%
                                        </p>
                                        <div class="text-sm font-medium ${calculations.retorno_capital > 8 ? 'text-green-600' : 'text-orange-600'}">
                                            ${calculations.retorno_capital > 8 ? '✓ Rentabilidad competitiva' : '⚠ Oportunidad de mejora'}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Simulador de Escenarios</h3>
                                <div class="space-y-4">
                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <h4 class="font-semibold text-blue-800 mb-2">Escenario Optimista (+10% Precio)</h4>
                                        <div class="text-sm space-y-1">
                                            <div class="flex justify-between">
                                                <span>Nuevo Precio:</span>
                                                <span>${formatCurrency(appData.precio_leche * 1.1)}/L</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>Lucro Proyectado:</span>
                                                <span class="font-bold text-green-600">
                                                    ${formatCurrency(calculations.lucro + (appData.volumen * appData.precio_leche * 0.1))}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-red-50 p-4 rounded-lg">
                                        <h4 class="font-semibold text-red-800 mb-2">Escenario Pesimista (-10% Precio)</h4>
                                        <div class="text-sm space-y-1">
                                            <div class="flex justify-between">
                                                <span>Nuevo Precio:</span>
                                                <span>${formatCurrency(appData.precio_leche * 0.9)}/L</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>Lucro Proyectado:</span>
                                                <span class="font-bold text-red-600">
                                                    ${formatCurrency(calculations.lucro - (appData.volumen * appData.precio_leche * 0.1))}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            tabContent.innerHTML = content;
            
            // Inicializar iconos de Lucide después de actualizar el contenido
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // Inicialización cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            renderTabs();
            renderTabContent();
            
            // Inicializar iconos de Lucide
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
